<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CouponDAO">
	<select id="getUser" parameterType="String"
		resultType="com.damino.web.user.login.UserVO">
		SELECT * FROM usermember WHERE userid = #{userid}
	</select>

	<insert id="insertManiaCoupon" parameterType="hashMap">
		INSERT ALL
		<choose>
			<when test="userlevel=='REGULAR'">
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MRD'||LPAD((select nvl(max(seq), 0)+1 from coupon), 8, '0'),(select nvl(max(seq),0)+1 from coupon), '배달주문 20% 할인쿠폰', '배달', 20, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MRD'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '배달주문 20% 할인쿠폰', '배달', 20, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
			</when>
			<when test="userlevel=='PREMIUM'">
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MPD'||LPAD((select nvl(max(seq), 0)+1 from coupon), 8, '0'), (select nvl(max(seq),0)+1 from coupon), '배달주문 20% 할인쿠폰', '배달', 20, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MPD'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '배달주문 25% 할인쿠폰', '배달', 25, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
			</when>
			<when test="userlevel=='VIP'">
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MVD'||LPAD((select nvl(max(seq), 0)+1 from coupon), 8, '0'), (select nvl(max(seq),0)+1 from coupon), '배달주문 20% 할인쿠폰', '배달', 20, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MVD'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '배달주문 30% 할인쿠폰', '배달', 30, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MVW'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '포장주문 35% 할인쿠폰', '포장', 35, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
			</when>
			<when test="userlevel=='ROYAL'">
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MLD'||LPAD((select nvl(max(seq), 0)+1 from coupon), 8, '0'), (select nvl(max(seq),0)+1 from coupon), '배달주문 20% 할인쿠폰', '배달', 20, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MLD'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '배달주문 30% 할인쿠폰', '배달', 30, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
				INTO coupon (coupon_code, seq, coupon_name, ordertype, discountrate, regdate, validity, chkusable, userid)
				VALUES('MLW'||LPAD((select nvl(max(seq), 0)+2 from coupon), 8, '0'), (select nvl(max(seq),0)+2 from coupon), '포장주문 40% 할인쿠폰', '포장', 40, sysdate, LAST_DAY(sysdate), 'Y', #{userid})
			</when>
		</choose>
		SELECT * FROM DUAL
	</insert>

</mapper>
