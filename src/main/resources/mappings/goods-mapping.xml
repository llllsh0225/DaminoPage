<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="GoodsListDAO">

	<!-- 프리미엄 피자 목록 불러오기 -->
	<select id="getPizzaList" resultType="com.damino.web.user.goods.GoodsPizzaVO">
		SELECT * FROM pizza WHERE p_type='프리미엄'
		ORDER BY seq desc
	</select>
	<!-- 클래식 피자 목록 불러오기 -->
	<select id="getPizzaClassicList" resultType="com.damino.web.user.goods.GoodsPizzaVO">
		SELECT * FROM pizza WHERE p_type='클래식'
		ORDER BY seq desc
	</select>
	
	<!-- 사이드메뉴 목록 불러오기 -->
	<select id="getSideList" resultType="com.damino.web.user.goods.GoodsSideVO">
		SELECT * FROM side
		ORDER BY seq desc
	</select>	

	<!-- 음료 및 기타 목록 불러오기 -->
	<select id="getDrinkEtcList" resultType="com.damino.web.user.goods.GoodsDrinkEtcVO">
		SELECT * FROM drink_etc
		ORDER BY seq desc
	</select>
	
	<!-- 사용자 선택 - 피자 메뉴 불러오기 -->
	<select id="getUserPizzaGoods" resultType="com.damino.web.user.goods.GoodsPizzaVO" parameterType="com.damino.web.user.goods.GoodsPizzaVO" >
		SELECT * FROM pizza WHERE p_code = #{p_code} AND p_name = #{p_name}
	</select>
	
	<!-- 메인 토핑 목록 불러오기 -->
	<select id="getMainTopping" resultType="com.damino.web.user.goods.GoodsToppingVO">
		SELECT * FROM topping WHERE t_type = '메인'
		ORDER BY seq desc
	</select>	
	
	<!-- 치즈 토핑 목록 불러오기 -->
	<select id="getCheezeTopping" resultType="com.damino.web.user.goods.GoodsToppingVO">
		SELECT * FROM topping WHERE t_type = '치즈'
		ORDER BY seq desc
	</select>

	<!-- 애프터 토핑 목록 불러오기 -->
	<select id="getAfterTopping" resultType="com.damino.web.user.goods.GoodsToppingVO">
		SELECT * FROM topping WHERE t_type = '애프터'
		ORDER BY seq desc
	</select>	
	
	<!-- 사용자 선택 - 사이드디시 메뉴 불러오기 -->
	<select id="getUserSideGoods" resultType="com.damino.web.user.goods.GoodsSideVO" parameterType="com.damino.web.user.goods.GoodsSideVO" >	
		SELECT * FROM side WHERE s_code = #{s_code} AND s_name = #{s_name}	
	</select>
	
	<!-- 사용자 선택 - 토핑 메뉴 불러오기 -->
	<select id="getUserTopping" resultType="com.damino.web.user.goods.GoodsToppingVO" parameterType="com.damino.web.user.goods.GoodsToppingVO" >	
		SELECT * FROM topping WHERE t_name = #{t_name}	
	</select>
	
	<!--  장바구니 정보 삽입 -->
	<insert id="insertBasket" parameterType="com.damino.web.user.goods.UserBasketVO">
		INSERT INTO userBasket (seq, pizzaPrice, pizzaSize, pizzaName, pizzaDough, pizzaCount, pizzaImage, toppingPrice, toppingName, toppingCount, sideName, sideCount, sidePrice,
		etcName, etcCount, etcPrice, userid)
		VALUES ((select nvl(max(seq), 0)+1 from userBasket), #{pizzaPrice}, #{pizzaSize}, #{pizzaName},#{pizzaDough}, #{pizzaCount}, #{pizzaImage}, #{toppingPrice},
		#{toppingName}, #{toppingCount}, #{sideName}, #{sideCount}, #{sidePrice}, #{etcName}, #{etcCount}, #{etcPrice}, #{userid})
	</insert>
	
	<!-- 장바구니 정보 불러오기 -->
	<select id="getBasketList" parameterType="String" resultType="com.damino.web.user.goods.UserBasketVO">
		SELECT * FROM userBasket
		WHERE userid = #{userid}
	</select>
	
	<!-- 장바구니 특정 토핑 이름, 토핑개수 삭제 -->
	<!-- update 테이블명 set 컬럼명 = replace(컬럼명, '대상문자', '치환될문자'); -->
	<update id="deleteToppingName" parameterType="com.damino.web.user.goods.UserBasketVO">
		UPDATE userBasket SET
		toppingName = REPLACE (toppingName, #{toppingName}, null),
		toppingCount = REPLACE (toppingCount, #{toppingCount}, null),
		toppingPrice = REPLACE (toppingPrice, #{toppingPrice}, null)
		WHERE userid = #{userid} AND seq = #{seq} AND toppingName = #{toppingName} 
	</update>
	
	<update id="deleteToppingCount" parameterType="com.damino.web.user.goods.UserBasketVO">
		UPDATE userBasket SET 
		WHERE userid = #{userid} AND seq = #{seq} 
	</update>
	
	<!-- 장바구니 피자정보 삭제 -->
	<update id="deletePizzaInfo" parameterType="com.damino.web.user.goods.UserBasketVO">
		UPDATE userBasket SET pizzaName = null, pizzaCount = null, pizzaImage = null, pizzaPrice = null, pizzaDough = null,
		toppingName = null, toppingCount = null, toppingPrice = null		
		WHERE userid = #{userid} AND seq = #{seq} AND pizzaName = #{pizzaName}
	</update>
	
	<!-- 장바구니 사이드디시 정보 삭제 -->
	<update id="deleteSideInfo" parameterType="com.damino.web.user.goods.UserBasketVO">
		UPDATE userBasket SET sideName = null, sideCount = null, sidePrice = null	
		WHERE userid = #{userid} AND seq = #{seq} AND sideName = #{sideName}
	</update>
	
	<!-- 장바구니 음료 정보 삭제 -->
	<update id="deleteEtcInfo" parameterType="com.damino.web.user.goods.UserBasketVO">
		UPDATE userBasket SET etcName = null, etcCount = null, etcPrice = null	
		WHERE userid = #{userid} AND seq = #{seq} AND etcName = #{etcName}
	</update>
</mapper>
